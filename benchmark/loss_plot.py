import matplotlib.pyplot as plt
import numpy as np

# HeavyBall External AdamW data
hb_external_steps = np.arange(100)
hb_external_losses = np.array([3.0330703258514404, 3.1081173419952393, 3.096999168395996, 2.6871228218078613, 2.5765650272369385, 2.3250389099121094, 2.0171010494232178, 2.048990488052368, 2.2310495376586914, 2.420860767364502, 1.9315824508666992, 1.9893571138381958, 1.9664992094039917, 1.873162031173706, 2.0043723583221436, 1.9076526165008545, 1.667261004447937, 1.7523847818374634, 1.7377262115478516, 1.8628432750701904, 1.7738667726516724, 1.5335360765457153, 1.6210952997207642, 1.3820428848266602, 1.5546914339065552, 1.4647691249847412, 1.2765182256698608, 1.3541440963745117, 1.2656192779541016, 1.5052293539047241, 1.3060846328735352, 1.358727216720581, 1.1872410774230957, 1.1387183666229248, 1.2388614416122437, 1.1933715343475342, 1.2354481220245361, 1.2859402894973755, 1.1853220462799072, 1.0822800397872925, 1.022782325744629, 1.1377415657043457, 1.0401790142059326, 1.3512318134307861, 0.9553751945495605, 1.0289373397827148, 1.1339712142944336, 1.2602903842926025, 0.9227644205093384, 1.0006316900253296, 0.9999157786369324, 1.0678832530975342, 1.034177541732788, 1.1109998226165771, 1.1419665813446045, 1.1845998764038086, 0.8239632248878479, 1.0151050090789795, 0.9915955066680908, 1.0260531902313232, 0.745502233505249, 0.8225091099739075, 1.1411842107772827, 0.9722881317138672, 1.025221347808838, 0.8902250528335571, 0.836804986000061, 0.9550719261169434, 1.0242552757263184, 1.0475114583969116, 0.9710051417350769, 0.7467775344848633, 0.9862447381019592, 0.9166528582572937, 0.9980049133300781, 1.1541118621826172, 0.7096527814865112, 0.7554912567138672, 0.959949254989624, 0.7918099761009216, 1.2260318994522095, 0.7878583073616028, 0.8159525394439697, 0.8668368458747864, 0.9555552005767822, 0.672573447227478, 0.9046726822853088, 0.8710569143295288, 0.8162320852279663, 0.9275975823402405, 0.8045796751976013, 1.0539942979812622, 0.736324667930603, 0.8269212245941162, 0.5891693830490112, 0.6991373300552368, 0.8678810596466064, 0.9173087477684021, 1.0907524824142456, 0.8681796789169312])

# Reference PyTorch AdamW data
ref_steps = np.arange(100)
ref_losses = np.array([3.2649, 3.0114, 3.1699, 2.6750, 2.3163, 2.2948, 2.1289, 2.0413, 2.1756, 2.3114, 1.9222, 2.0495, 2.0189, 1.9136, 2.0094, 1.8992, 1.8739, 1.8262, 1.8143, 1.7641, 1.7249, 1.6891, 1.6710, 1.5679, 1.6168, 1.4094, 1.4466, 1.4209, 1.3672, 1.3955, 1.3425, 1.5008, 1.1940, 1.2534, 1.3433, 1.2647, 1.1392, 1.4064, 1.1589, 1.2351, 0.9480, 1.0772, 1.0977, 1.0998, 1.1303, 1.0048, 0.9552, 1.1626, 1.0745, 0.9077, 1.1414, 1.0252, 1.1572, 0.9830, 1.0278, 0.9368, 0.9201, 1.0250, 1.2312, 1.1136, 0.8240, 0.7939, 0.9430, 0.9271, 1.0146, 0.8575, 0.9740, 1.0096, 0.9788, 0.8303, 0.7321, 0.6801, 1.0827, 0.8840, 0.9994, 1.0694, 0.8851, 0.8304, 0.9244, 0.8894, 0.9630, 0.7088, 0.9130, 0.9165, 0.9290, 0.7729, 0.9403, 0.8858, 0.8362, 1.0961, 0.8046, 0.8998, 0.8507, 0.6505, 0.8888, 0.6466, 1.0112, 0.8095, 0.8539, 0.7298])

# Create the plot
plt.figure(figsize=(12, 8))
plt.plot(hb_external_steps, hb_external_losses, 'b-', label='HeavyBall External AdamW', linewidth=2, alpha=0.8)
plt.plot(ref_steps, ref_losses, 'r-', label='Reference PyTorch AdamW', linewidth=2, alpha=0.8)

plt.xlabel('Training Steps', fontsize=12)
plt.ylabel('Training Loss', fontsize=12)
plt.title('Training Loss Comparison: HeavyBall vs Reference AdamW', fontsize=14)
plt.legend(fontsize=11)
plt.grid(True, alpha=0.3)
plt.yscale('log')  # Use log scale since losses vary significantly
plt.xlim(0, 99)

# Add some statistics
hb_final_loss = hb_external_losses[-1]
ref_final_loss = ref_losses[-1]
hb_min_loss = np.min(hb_external_losses)
ref_min_loss = np.min(ref_losses)

plt.text(0.02, 0.98, f'HeavyBall Final Loss: {hb_final_loss:.4f}\nReference Final Loss: {ref_final_loss:.4f}\n\nHeavyBall Min Loss: {hb_min_loss:.4f}\nReference Min Loss: {ref_min_loss:.4f}', 
         transform=plt.gca().transAxes, fontsize=10, verticalalignment='top',
         bbox=dict(boxstyle='round', facecolor='wheat', alpha=0.8))

plt.tight_layout()
plt.savefig("loss_plot")

# Print some comparison statistics
print(f"Final Loss Comparison:")
print(f"HeavyBall External AdamW: {hb_final_loss:.4f}")
print(f"Reference PyTorch AdamW: {ref_final_loss:.4f}")
print(f"Difference: {abs(hb_final_loss - ref_final_loss):.4f}")

print(f"\nMinimum Loss Comparison:")
print(f"HeavyBall External AdamW: {hb_min_loss:.4f}")
print(f"Reference PyTorch AdamW: {ref_min_loss:.4f}")
print(f"Difference: {abs(hb_min_loss - ref_min_loss):.4f}")